systemd:
cd /usr/lib/systemd/system/
wget https://bitbucket.org/lijianying10/mesos-single-docker/raw/1dd291fb196e9403f71eb44152fb7da4cc3589cc/systemd/docker.service
wget https://bitbucket.org/lijianying10/mesos-single-docker/raw/1dd291fb196e9403f71eb44152fb7da4cc3589cc/systemd/system-docker.service
wget https://bitbucket.org/lijianying10/mesos-single-docker/raw/1dd291fb196e9403f71eb44152fb7da4cc3589cc/systemd/system-docker.socket


get-etcd:
#REG=docker.elenet.me/jianying.li
#REG=index.alauda.cn/philo
REG=afafaf.newb.xyz

docker -H unix:///var/run/system-docker.sock pull  afafaf.newb.xyz/etcd:2.3.7
docker -H unix:///var/run/system-docker.sock tag afafaf.newb.xyz/etcd:2.3.7 etcd:2.3.7

system-docker-etcd:

HostIP=192.168.56.101
docker -H unix:///var/run/system-docker.sock run -it --net=host --privileged -d --name etcd etcd:2.3.7\
 /etcd -name etcd0 \
 -advertise-client-urls http://${HostIP}:2379,http://${HostIP}:4001 \
 -listen-client-urls http://0.0.0.0:2379,http://0.0.0.0:4001 \
 -initial-advertise-peer-urls http://${HostIP}:2380 \
 -listen-peer-urls http://0.0.0.0:2380 \
 -initial-cluster-token etcd-cluster-1 \
 -initial-cluster etcd0=http://${HostIP}:2380 \
 -initial-cluster-state new
 
deploy flannel:

#REG=docker.elenet.me/jianying.li
#REG=index.alauda.cn/philo
REG=afafaf.newb.xyz

docker -H unix:///var/run/system-docker.sock pull afafaf.newb.xyz/flannel:0.5.5
docker -H unix:///var/run/system-docker.sock tag afafaf.newb.xyz/flannel:0.5.5 flannel:0.5.5

Add flannel subnet:
docker -H unix:///var/run/system-docker.sock exec -it etcd /etcdctl set /coreos.com/network/config '{ "Network": "10.1.0.0/16" }'


runflannel:

docker -H unix:///var/run/system-docker.sock run --name flannel -it -d -v /run/flannel/:/run/flannel/ --net=host --privileged flannel:0.5.5 /opt/bin/flanneld --ip-masq=true --iface=enp0s3 -etcd-endpoints="http://192.168.56.101:4001,http://192.168.56.101:2379"

update flannel systemctl
```
[Unit]
Description=Docker Application Container Engine
Documentation=https://docs.docker.com
After=network.target docker.socket
Requires=docker.socket

[Service]
Type=notify
EnvironmentFile=/run/flannel/subnet.env
# the default is not to use systemd for cgroups because the delegate issues still
# exists and systemd currently does not support the cgroup feature set required
# for containers run by docker
ExecStart=/usr/bin/docker --bip=${FLANNEL_SUBNET} --mtu=${FLANNEL_MTU} daemon -H fd://
MountFlags=slave
LimitNOFILE=1048576
LimitNPROC=1048576
LimitCORE=infinity
TimeoutStartSec=0
# set delegate yes so that systemd does not reset the cgroups of docker containers
Delegate=yes

[Install]
WantedBy=multi-user.target
```


